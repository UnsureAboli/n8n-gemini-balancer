# n8n-gemini-router

یک ورک‌فلو n8n برای **مسیریابی هوشمند (Smart Routing)** و **توزیع بار (Load Balancing)** بین چندین کلید API گوگل جمنای. این پروژه برای دور زدن محدودیت تعداد درخواست (Rate Limit) در کلیدهای API رایگان طراحی شده است.

---

### 💡 مشکل چیست؟

استفاده از کلیدهای API رایگان گوگل جمنای با **محدودیت تعداد درخواست** در دقیقه یا روز همراه است. اگر تمام درخواست‌های یک سرویس از طریق یک کلید ارسال شود، به سرعت به این محدودیت خواهید رسید و سرویس شما تا زمان آزاد شدن مجدد، متوقف خواهد شد.

### ✅ راه حل

این ورک‌فلو به عنوان یک **مسیریاب (Router)** هوشمند عمل می‌کند. به جای استفاده از یک کلید ثابت، این سیستم یک **"استخر" (Pool) از کلیدهای API** شما را مدیریت می‌کند. در هر بار اجرا، به صورت تصادفی یکی از کلیدها را انتخاب کرده و درخواست را از طریق آن ارسال می‌کند.

این کار باعث می‌شود بار ترافیکی به جای تمرکز روی یک کلید، بین همه کلیدها تقسیم شود و احتمال رسیدن به محدودیت به شدت کاهش یابد.

---

## ⚙️ نحوه عملکرد

این ورک‌فلو از سه بخش اصلی تشکیل شده است:

1.  **گره کد (Code Node):** انتخاب‌گر تصادفی.
2.  **مجموعه مدل‌های جمنای (Gemini Models):** استخر کلیدهای API شما.
3.  **انتخاب‌گر مدل (Model Selector):** مسیریاب اصلی.

![نمای ورک‌فلو n8n-gemini-router](https://github.com/UnsureAboli/n8n-gemini-balancer/raw/main/image_2025-09-05_003759571.png)

### توضیحات گره کد (`Code` Node)

نقش این گره، تولید یک **عدد تصادفی** است که به عنوان مکانیزم انتخاب عمل می‌کند.

```javascript
const randomNumber = Math.floor(Math.random() * 10) + 1;
return { randomNumber };
Math.random(): یک عدد اعشاری تصادفی بین 0 و 1 تولید می‌کند (مثلاً 0.723).

* 10: با ضرب این عدد در ۱۰، بازه آن به 0 تا 10 تغییر می‌کند (مثلاً 7.23).

Math.floor(): قسمت اعشاری عدد را حذف کرده و آن را به یک عدد صحیح تبدیل می‌کند (مثلاً 7).

+ 1: با اضافه کردن ۱، بازه نهایی به ۱ تا ۱۰ تبدیل می‌شود.

این عدد تصادفی سپس به گره Model Selector ارسال می‌شود تا مشخص کند کدام یک از کلیدهای API باید در آن اجرا استفاده شود.

نحوه استفاده
فایل workflow.json را در محیط n8n خود ایمپورت کنید.

در هر یک از گره‌های Google Gemini Chat Model، یکی از کلیدهای API رایگان خود را در بخش Credentials وارد کنید.

تمام! اکنون می‌توانید این ورک‌فلو را به عنوان نقطه ورودی برای تمام درخواست‌های خود به Gemini استفاده کنید.
